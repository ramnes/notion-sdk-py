# New API Upgrade (2025-09-03)

This SDK now targets Notion API version 2025-09-03 by default. The
release introduces data sources under databases and moves most
database‑scoped operations to `/v1/data_sources`.

## What Changed in This SDK

- Default `Notion-Version`: `2025-09-03` set in `ClientOptions`.
- New endpoint group:
  `client.data_sources.retrieve/query/update/create`.
- Databases shim:
  - `databases.create`: moves `properties` to
    `initial_data_source.properties` automatically.
  - `databases.update`: schema changes must go to
    `data_sources.update(data_source_id, properties=...)`.
  - `databases.query`: on 2025-09-03 requires `data_source_id` and
    routes to `data_sources.query`.
- Search: filter `{property: "object", value: "database"}` maps to
  `"data_source"`.
- Error codes: adds `multiple_data_sources_for_database`.

## New Way of Doing Things

- Identify data sources under a database:

  ```python
  db = client.databases.retrieve(database_id)
  ds_id = db["data_sources"][0]["id"]  # choose one if multiple
  ```

- Query (data source, not database):

  ```python
  res = client.data_sources.query(
      ds_id, filter={...}, sorts=[...], page_size=50
  )
  ```

- Create a page under a data source:

  ```python
  page = client.pages.create(
      parent={"type": "data_source_id", "data_source_id": ds_id},
      properties={"Name": {"title": [{"text": {"content": "New"}}]}},
  )
  ```

- Update schema (via data sources):

  ```python
  client.data_sources.update(
      ds_id,
      properties={
          "Restocked (new)": {"type": "checkbox", "checkbox": {}},
          "In stock": None,
      },
      title=[{"text": {"content": "New Title"}}],
  )
  ```

- Create a new data source under an existing database:

  ```python
  ds = client.data_sources.create(
      parent={"type": "database_id", "database_id": DB_ID},
      properties={
          "Name": {"title": {}},
          "In stock": {"checkbox": {}},
      },
      title=[{"text": {"content": "Retail Inventory"}}],
  )
  ```

- Create a database (initial data source schema):

  ```python
  db = client.databases.create(
      parent={"type": "page_id", "page_id": PAGE_ID},
      title=[{"text": {"content": "Inventory"}}],
      # either provide properties (auto-moved) or explicit initial_data_source
      properties={"Name": {"title": {}}},
      # or: initial_data_source={"properties": {"Name": {"title": {}}}},
  )
  ```

- Search (object filter):

  ```python
  res = client.search(
      query="widgets",
      filter={"property": "object", "value": "data_source"},
  )
  ```

## Cleanup Checklist

- Replace `databases.query(database_id=...)` →
  `data_sources.query(data_source_id=...)`.
- Replace page parents using `database_id` → `data_source_id`.
- Move schema edits from `databases.update(..., properties=...)` →
  `data_sources.update`.
- Use `databases.create(..., initial_data_source={"properties": ...})` for
  new DBs (SDK auto-maps if you pass `properties`).
- Update Search filters to use `"data_source"`.

If you need to interop with older behavior, you can override the version
via `Client(notion_version="2022-06-28")`, but this SDK’s default and
examples assume 2025-09-03.
